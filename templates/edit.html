<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Editar Registro</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { margin-top: 8px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; background:#fafafa; max-width: 640px; }
    label { display:block; margin-top:8px; }
    input, select, textarea { width: 100%; max-width: 520px; padding:6px; }
    textarea { height: 80px; }
    .btn { display:inline-block; padding: 6px 12px; margin-top: 10px; cursor: pointer; border: none; border-radius: 4px; }
    .btn-primary { background:#007BFF; color:#fff; }
  </style>
  <script>
    function togglePersonalizado(value){
      const lab = document.getElementById("personalizado_label");
      const inp = document.getElementById("personalizado_input");
      if(value === "personalizado"){ lab.style.display="block"; inp.style.display="block"; }
      else { lab.style.display="none"; inp.style.display="none"; }
    }
    window.addEventListener('DOMContentLoaded', function(){
      const sel = document.getElementById('prazo_sel');
      togglePersonalizado(sel.value);
    });
  </script>
</head>
<body>
  <h2>Editar Registro</h2>
  <form method="POST">
    <label>Loja</label>
    <input type="text" value="{{ registro.loja }}" readonly>

    <label>Fornecedor</label>
    <select name="empresa" required>
      {% for f in fornecedores %}
        <option value="{{ f }}" {% if f == registro.empresa %}selected{% endif %}>{{ f }}</option>
      {% endfor %}
    </select>

    <label>Funcionário</label>
    <input type="text" name="funcionario" value="{{ registro.funcionario }}" required>

    <label>Data</label>
    <input type="date" name="data" value="{{ registro.data|dmy_to_iso }}" required>

    <label>Hora</label>
    <input type="time" name="hora" value="{{ registro.hora }}" required>

    <label>Prazo do próximo serviço</label>
    {% set is_custom = ('meses' in registro.prazo and registro.prazo not in ['15 dias','1 mês','2 meses','3 meses','6 meses','12 meses']) %}
    <select name="prazo" id="prazo_sel" onchange="togglePersonalizado(this.value)">
      <option value="15 dias"  {% if registro.prazo == '15 dias' %}selected{% endif %}>15 dias</option>
      <option value="1 mês"    {% if registro.prazo == '1 mês' %}selected{% endif %}>1 mês</option>
      <option value="2 meses"  {% if registro.prazo == '2 meses' %}selected{% endif %}>2 meses</option>
      <option value="3 meses"  {% if registro.prazo == '3 meses' %}selected{% endif %}>3 meses</option>
      <option value="6 meses"  {% if registro.prazo == '6 meses' %}selected{% endif %}>6 meses</option>
      <option value="12 meses" {% if registro.prazo == '12 meses' %}selected{% endif %}>12 meses</option>
      <option value="personalizado" {% if is_custom %}selected{% endif %}>Personalizado (meses)</option>
    </select>
    <label id="personalizado_label" style="display:none;">Informe os meses (número)</label>
    <input type="number" name="personalizado" id="personalizado_input" min="1"
           value="{% if is_custom %}{{ registro.prazo.split()[0] }}{% endif %}" placeholder="Ex.: 8" style="display:none;">

    <label>Observações</label>
    <textarea name="observacoes">{{ registro.observacoes }}</textarea>

    <button type="submit" class="btn btn-primary">Salvar</button>
  </form>
</body>
</html>
