<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Agenda de Prestadores</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        label { display: block; margin-top: 10px; }
        input, select, textarea { padding: 5px; margin-top: 5px; width: 300px; }
        button { margin-top: 15px; padding: 8px 15px; }
        table { border-collapse: collapse; margin-top: 20px; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <h1>Agenda de Prestadores</h1>

    <!-- Formul√°rio -->
    <form method="post">
        <label>Loja:
            <select name="loja" required>
                <option value="">Selecione</option>
                <option value="4g Com√©rcio de Alimentos e Bebidas Ltda">4g Com√©rcio de Alimentos e Bebidas Ltda</option>
                <option value="Tenro Plaza Niter√≥i Ltda">Tenro Plaza Niter√≥i Ltda</option>
                <option value="Gdm Caf√©s e Bolos Ltda">Gdm Caf√©s e Bolos Ltda</option>
                <option value="Tenro Caf√© Am√©ricas">Tenro Caf√© Am√©ricas</option>
            </select>
        </label>

        <label>Fornecedor/Empresa:
            <input type="text" name="empresa" required>
        </label>

        <label>Funcion√°rio:
            <input type="text" name="funcionario" required>
        </label>

        <label>Data do servi√ßo:
            <input type="date" name="data" required>
        </label>

        <label>Hora do servi√ßo:
            <input type="time" name="hora" required>
        </label>

        <label>Prazo do pr√≥ximo servi√ßo:</label>
        <select name="prazo" id="prazo">
            <option value="15 dias">15 dias</option>
            <option value="1 m√™s">1 m√™s</option>
            <option value="2 meses">2 meses</option>
            <option value="3 meses">3 meses</option>
            <option value="6 meses">6 meses</option>
            <option value="12 meses">12 meses</option>
            <option value="personalizado">Personalizado (meses)</option>
        </select>

        <input type="number" id="personalizado" name="personalizado" min="1" style="display:none;" placeholder="Digite meses">

        <label>Observa√ß√µes:
            <textarea name="observacoes" rows="3"></textarea>
        </label>

        <button type="submit">Salvar</button>
    </form>

    <!-- Filtro -->
    <div class="count">Total de registros: {{ count }}</div>

    <form method="get">
      {% if loja_lock %}
        <input type="hidden" name="loja" value="{{ loja_lock }}">
        <input type="hidden" name="pin" value="{{ pin }}">
      {% endif %}
      <label>De: <input type="date" name="inicio" value="{{ filtro_inicio }}"></label>
      <label>At√©: <input type="date" name="fim" value="{{ filtro_fim }}"></label>
      <button type="submit">Filtrar</button>
      <a href="{{ url_for('index', loja=loja_lock, pin=pin) }}">Limpar filtro</a>
    </form>

    <p>
      <a href="{{ url_for('download_csv', loja=loja_lock, pin=pin, inicio=filtro_inicio, fim=filtro_fim) }}">üì• Baixar CSV</a> |
      <a href="{{ url_for('download_pdf', loja=loja_lock, pin=pin, inicio=filtro_inicio, fim=filtro_fim) }}">üìÑ Baixar PDF</a>
    </p>

    <!-- Tabela -->
    <table>
        <thead>
            <tr>
                <th>Loja</th>
                <th>Empresa</th>
                <th>Funcion√°rio</th>
                <th>Data</th>
                <th>Hora</th>
                <th>Prazo</th>
                <th>Pr√≥xima Data</th>
                <th>Observa√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for row in registros %}
            <tr>
                <td>{{ row['loja'] }}</td>
                <td>{{ row['empresa'] }}</td>
                <td>{{ row['funcionario'] }}</td>
                <td>{{ row['data'] }}</td>
                <td>{{ row['hora'] }}</td>
                <td>{{ row['prazo'] }}</td>
                <td>{{ row['proxima_data'] }}</td>
                <td>{{ row['observacoes'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
      const prazoSelect = document.getElementById("prazo");
      const personalizadoInput = document.getElementById("personalizado");
      prazoSelect.addEventListener("change", function() {
        if (this.value === "personalizado") {
          personalizadoInput.style.display = "inline-block";
        } else {
          personalizadoInput.style.display = "none";
          personalizadoInput.value = "";
        }
      });
    </script>
</body>
</html>
